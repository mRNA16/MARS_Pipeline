# MARS 流水线模式使用说明 (Usage Guide)

欢迎使用集成流水线仿真特性的 MARS MIPS 模拟器。本说明旨在帮助您快速掌握如何使用流水线模式进行 MIPS 程序调试与教学演示。

---

## 1. 如何启用流水线模式

在运行程序之前，您需要手动开启仿真模式：

1.  打开菜单栏的 **`Settings` (设置)**。
2.  找到并勾选 **`Pipeline mode` (流水线模式)**。
3.  **自动生效**：开启后，界面布局会自动调整以适配流水线窗口，且当前程序会自动重新汇编。

> [!TIP]
> 开启该模式后，建议配合 `Step` (单步执行) 功能使用，以清晰观察指令流。

---

## 2. 三大核心可视化窗口

### 2.1 流水线动态图 (Pipeline Window)
展示经典的 **五级流水线** 架构（IF, ID, EX, MEM, WB）：
*   **实时状态**：显示当前每个阶段正在执行的指令。
*   **代码追踪**：**双击** 任意阶段的方框，编辑器会自动跳转到该指令对应的源代码行。

### 2.2 时钟周期图 (Clock Cycle Diagram)
从“指令流”视角展示执行进度：
*   **纵轴**：指令列表。
*   **横轴**：时钟周期。
*   **自动跟随**：视图会自动锁定在当前活动的周期中心，方便观察最新进展。

### 2.3 流水线快照 (Pipeline Snapshot)
提供完整的历史执行视图：
*   以表格形式记录了所有已执行周期的流水线状态。
*   **视觉优化**：修复了旧版本中的残影问题，提供现代化的渲染效果。

---

## 3. 仿真技术特性

### 3.1 冲突与前推 (Hazards & Forwarding)
*   **数据前推 (Bypass)**：系统默认支持数据前推技术，最大限度减少由于数据相关导致的停顿。
*   **停顿指示**：当发生无法通过前推解决的冲突（如 Load-Use 相关）时，方框会显示 **红色边框**，表示该阶段发生了 **Stall (停顿)**，并自动插入 **Bubble (气泡/NOP)**。

### 3.2 控制冲突处理
*   **延迟槽 (Delayed Branching)**：可以在 `Settings` 中开启或关闭。
*   **指令清除 (Flush)**：如果不开启延迟槽，当跳转/分支发生时，流水线会自动清除（Flush）错误读取的指令。

---

## 4. 调试建议

*   **单步步进 (Step)**：每次点击推进一个时钟周期（Clock Cycle），而不是一条指令。
*   **单步回退 (Backstep)**：支持通过撤销（Undo）功能回到上一个周期状态，这对于分析复杂的流水线冲突非常有用。
*   **颜色标识**：
    *   **蓝色 (IF)**: 取指
    *   **黄色 (ID)**: 译码
    *   **红色 (EX)**: 执行
    *   **绿色 (MEM)**: 访存
    *   **紫色 (WB)**: 写回

